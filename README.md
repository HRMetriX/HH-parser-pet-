# HH-parser-pet-: Анализ рынка труда аналитиков в России

Ежедневный сбор вакансий с hh.ru → пересчёт зарплат в рубли с учётом курса ЦБ РФ → визуализация в Yandex DataLens

Этот pet-проект автоматически отслеживает динамику зарплат, географию спроса и структуру вакансий для аналитиков по всей России — с историей с 2024 года и ежедневным обновлением.

## Что делает pipeline?

### Сбор данных
- Запросы к API hh.ru по ключевым словам: `аналитик`, `analytic`
- Только вакансии с названием (не в описании)
- Покрытие всех регионов России

### Конвертация валют
- Ежедневная загрузка курсов USD/RUB и EUR/RUB с официального API ЦБ РФ
- Пересчёт зарплат по курсу на дату публикации вакансии
- Учёт НДФЛ (13%) при `salary_gross = true`

### Геопривязка
- Координаты городов из API hh.ru (`/areas/113`)
- Поддержка карт в Yandex DataLens

### Автоматизация
- Ежедневный запуск в 00:06 МСК через GitHub Actions
- Backfill исторических данных (2024–настоящее время)

### Визуализация
- Интерактивный дашборд в Yandex DataLens (без VPN!)
- Карта России, тренды по зарплатам, топ компаний и регионов

## Структура проекта
### Таблица файлов

| Путь | Описание |
|------|----------|
| `HH-parser-pet-/src/backfill.py` | Полный исторический сбор (запускать 1 раз) |
| `HH-parser-pet-/src/fetch_hh_daily.py` | Ежедневное обновление вакансий |
| `HH-parser-pet-/src/currency_updater.py` | Ежедневная загрузка курсов ЦБ РФ |
| `HH-parser-pet-/src/utils/backfill.py` | Утилиты для backfill |
| `HH-parser-pet-/src/utils/daily.py` | Утилиты для ежедневного обновления |
| `HH-parser-pet-/.github/workflows/hh_daily.yml` | Запуск в 00:06 МСК |
| `HH-parser-pet-/.github/workflows/currency_daily.yml` | Запуск в 00:01 МСК |
| `HH-parser-pet-/requirements.txt` | Зависимости Python |
| `HH-parser-pet-/README.md` | Этот файл |

## Технологии

- **Язык:** Python 3.11
- **Хранилище:** Supabase (PostgreSQL)
- **Оркестрация:** GitHub Actions
- **Источники данных:**
    - hh.ru API (вакансии)
    - ЦБ РФ API (курсы валют)
- **Визуализация:** Yandex DataLens

## Как запустить

### 1. Backfill (локально, один раз)

```bash
python src/backfill.py

Требует переменных окружения:
SUPABASE_URL, SUPABASE_KEY

2. Ежедневное обновление
Автоматически запускается через GitHub Actions.
Для теста вручную:

python src/fetch_hh_daily.py
python src/currency_updater.py
```

## Примеры аналитики

- Средняя net-зарплата по городам (с учётом курса и НДФЛ)
- Доля вакансий с полной вилкой (from/to)
- Топ-10 работодателей по средней ЗП
- Динамика зарплат по дням и неделям
- Распределение по опыту и типу занятости
- Интерактивная карта России с точками-вакансиями

## Схема базы данных

**Таблица hh_vacancies**

Содержит все вакансии с вычисляемыми полями:

- salary_from_rur, salary_to_rur — зарплата в рублях
- salary_from_net_rur, salary_to_net_rur — после НДФЛ
- salary_final_net_rur — финальная ЗП (to → from)
- mean_salary_net_rur — среднее значение вилки

**Таблица currency_rates**
- Ежедневные курсы USD и EUR к рублю от ЦБ РФ.

**Таблица city_geo**
- Справочник городов с координатами для карт.

```bash
Автор
Oleg Borisov
hr@golrg-borisov.ru

Проект создан как pet-проект, но полностью готов к использованию в аналитике рынка труда.
```
